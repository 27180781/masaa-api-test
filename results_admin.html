<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דשבורד תוצאות</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; color: #333; display: flex; gap: 20px;}
        nav a { margin-left: 20px; font-size: 18px; display: block; margin-bottom: 10px; }
        .sidebar { flex-basis: 300px; }
        .main-content { flex-grow: 1; }
        h1, h2 { color: #1d5b85; border-bottom: 2px solid #1d5b85; padding-bottom: 5px;}
        .game-list { list-style: none; padding: 0; }
        .game-item { background-color: #f7f8fb; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; padding: 15px; cursor: pointer; }
        .game-item:hover { background-color: #eaf4f9; }
        #gameDetails { background-color: #fff; padding: 20px; border-radius: 5px; border: 1px solid #ccc; min-height: 400px; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; text-align: left; direction: ltr; }
    </style>
</head>
<body>
    <div class="sidebar">
        <nav>
            <a href="/admin">ניהול שאלות</a>
            <a href="/games_admin">ניהול משחקים</a>
            <a href="/results_admin">דשבורד תוצאות</a>
        </nav>
        <h2>משחקים שנשמרו</h2>
        <ul id="gamesList" class="game-list">
            </ul>
    </div>

    <div class="main-content">
        <h1>דשבורד תוצאות</h1>
        <h2>פרטי המשחק שנבחר</h2>
        <div id="gameDetails">
            <p>בחר משחק מהרשימה כדי לראות את פרטיו.</p>
        </div>
    </div>

    <script>
        const gamesList = document.getElementById('gamesList');
        const gameDetails = document.getElementById('gameDetails');

        async function fetchGameList() {
            try {
                const response = await fetch('/api/results');
                const games = await response.json();
                
                gamesList.innerHTML = '';
                games.forEach(game => {
                    const li = document.createElement('li');
                    li.className = 'game-item';
                    li.dataset.gameId = game.game_id;
                    li.innerHTML = `
                        <strong>מזהה:</strong> ${game.game_id}<br>
                        <small>מייל: ${game.client_email || 'לא צוין'}</small><br>
                        <small>תאריך: ${new Date(game.processed_at).toLocaleString('he-IL')}</small>
                    `;
                    li.addEventListener('click', () => fetchGameDetails(game.game_id));
                    gamesList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching game list:', error);
                gamesList.innerHTML = '<li>שגיאה בטעינת רשימת המשחקים</li>';
            }
        }

        async function fetchGameDetails(gameId) {
            try {
                gameDetails.innerHTML = '<p>טוען נתונים...</p>';
                const response = await fetch(`/api/results/${gameId}`);
                const details = await response.json();
                
                // שימוש ב-JSON.stringify להצגת כל הנתונים בצורה קריאה
                gameDetails.innerHTML = `
                    <h2>פרטי משחק: ${details.game_id}</h2>
                    <pre>${JSON.stringify(details, null, 2)}</pre>
                `;
            } catch (error) {
                console.error('Error fetching game details:', error);
                gameDetails.innerHTML = `<p>שגיאה בטעינת פרטי המשחק: ${gameId}</p>`;
            }
        }

        // טעינת רשימת המשחקים בפעם הראשונה
        fetchGameList();
    </script>
</body>
</html>